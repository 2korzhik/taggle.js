/*!
* @author Sean Coker <sean@seancoker.com>
* @version 1.3.0
* @url http://sean.is/poppin/tags
* @license MIT
* @description Taggle is a dependency-less tagging library
*/
(function(){Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,a=function(){},i=function(){return n.apply(this instanceof a&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return a.prototype=this.prototype,i.prototype=new a,i}),window.getComputedStyle||(window.getComputedStyle=function(e){return e.currentStyle}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(null==this)throw new TypeError;var t,n,a=Object(this),i=a.length>>>0;if(0===i)return-1;if(t=0,arguments.length>1&&(t=Number(arguments[1]),t!=t?t=0:0!=t&&1/0!=t&&t!=-1/0&&(t=(t>0||-1)*Math.floor(Math.abs(t)))),t>=i)return-1;for(n=t>=0?t:Math.max(i-Math.abs(t),0);i>n;n++)if(n in a&&a[n]===e)return n;return-1})})(),function(){"undefined"==typeof document||"classList"in document.documentElement||function(e){"use strict";if("HTMLElement"in e||"Element"in e){var t="classList",n="prototype",a=(e.HTMLElement||e.Element)[n],i=Object,s=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},r=Array[n].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},l=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},o=function(e,t){if(""===t)throw new l("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new l("INVALID_CHARACTER_ERR","String contains an invalid character");return r.call(e,t)},c=function(e){for(var t=s.call(e.className),n=t?t.split(/\s+/):[],a=0,i=n.length;i>a;a++)this.push(n[a]);this._updateClassName=function(){e.className=""+this}},u=c[n]=[],d=function(){return new c(this)};if(l[n]=Error[n],u.item=function(e){return this[e]||null},u.contains=function(e){return e+="",-1!==o(this,e)},u.add=function(){var e,t=arguments,n=0,a=t.length,i=!1;do e=t[n]+"",-1===o(this,e)&&(this.push(e),i=!0);while(a>++n);i&&this._updateClassName()},u.remove=function(){var e,t=arguments,n=0,a=t.length,i=!1;do{e=t[n]+"";var s=o(this,e);-1!==s&&(this.splice(s,1),i=!0)}while(a>++n);i&&this._updateClassName()},u.toggle=function(e,t){e+="";var n=this.contains(e),a=n?t!==!0&&"remove":t!==!1&&"add";return a&&this[a](e),!n},u.toString=function(){return this.join(" ")},i.defineProperty){var g={get:d,enumerable:!0,configurable:!0};try{i.defineProperty(a,t,g)}catch(p){-2146823252===p.number&&(g.enumerable=!1,i.defineProperty(a,t,g))}}else i[n].__defineGetter__&&a.__defineGetter__(t,d)}}(self)}(),function(e,t){function n(){if(!(2>arguments.length)){for(var e=arguments[0],t=1,n=arguments.length;n>t;t++){var a=arguments[t];for(var i in a)a.hasOwnProperty(i)&&(e[i]=a[i])}return e}}function a(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}function i(e,t){var n="a"===e.tagName.toLowerCase()?e.parentNode:e,a=t.elements.indexOf(n);t.elements.splice(a,1),t.values.splice(a,1)}function s(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}function r(e){return e.replace(/^\s+|\s+$/g,"")}function l(t,n){e.attachEvent&&!e.addEventListener?t.innerText=n:t.textContent=n}var o={additionalTagClasses:"",allowDuplicates:!1,duplicateTagClass:"",containerFocusClass:"active",hiddenInputName:"taggles[]",tags:[],tabIndex:1,placeholder:"Enter tags...",onTagAdd:function(){},onTagRemove:function(){}},c=8,u=188,d=9,g=13,p=function(p,f){function h(){v(),m(),y()}function v(){var t,n,a;q.container.rect=B.getBoundingClientRect(),q.container.style=e.getComputedStyle(B),t=q.container.style,n=parseInt(t["padding-left"]||t.paddingLeft,10),a=parseInt(t["padding-right"]||t.paddingRight,10),q.container.padding=n+a}function m(){var t;if(M.className="taggle_list",H.type="text",H.className="taggle_input",H.tabIndex=D.tabIndex,P.className="taggle_sizer",D.tags.length)for(var n=0,a=D.tags.length;a>n;n++){var i=R(D.tags[n]);M.appendChild(i)}O&&(O.style.opacity=0,O.classList.add("taggle_placeholder"),B.appendChild(O),l(O,D.placeholder),D.tags.length||(O.style.opacity=1)),z.appendChild(H),M.appendChild(z),B.appendChild(M),B.appendChild(P),t=e.getComputedStyle(H)["font-size"],P.style.fontSize=t}function y(){s(B,"click",function(){H.focus()}),H.onfocus=N,H.onblur=b,s(H,"keydown",x),s(H,"keyup",A)}function C(){var e,t,n,a,i;E(),t=H.getBoundingClientRect(),n=q.container.rect,e=~~n.width,e||(e=~~n.right-~~n.left),a=~~t.left-~~n.left,i=q.container.padding,E(e-a-i)}function L(e,t){var n,a,i,s="string"==typeof t?t.toLowerCase():r(H.value.toLowerCase());!D.allowDuplicates&&T()||""===s||(n=R(s),a=M.querySelectorAll("li"),i=a[a.length-1],M.insertBefore(n,i),D.onTagAdd(e,s),H.value="",E(),C(),N())}function w(t){t=t||e.event;var n=B.querySelectorAll(".taggle"),a=n[n.length-1],i="taggle_hot",s=H.classList.contains("taggle_back");""!==H.value||t.keyCode!==c||s?a.classList.contains(i)&&a.classList.remove(i):a.classList.contains(i)?(H.classList.add("taggle_back"),k(a,t),C(),N()):a.classList.add(i)}function E(e){H.style.width=(e||10)+"px"}function T(e){var t,n=H.value,a=e?e.toLowerCase():r(n.toLowerCase()),i=j.values.indexOf(a),s=B.querySelector(".taggle_list");if(D.duplicateTagClass){t=s.querySelectorAll("."+D.duplicateTagClass);for(var l=0,o=t.length;o>l;l++)t[l].classList.remove(D.duplicateTagClass)}return i>-1?(D.duplicateTagClass&&s.childNodes[i].classList.add(D.duplicateTagClass),!0):!1}function _(e){var t=!1;return(e===u||e===d||e===g)&&(t=!0),t}function N(){C(),B.classList.contains(D.containerFocusClass)||B.classList.add(D.containerFocusClass),O&&(O.style.opacity=0)}function b(){H.value="",E(),B.classList.contains(D.containerFocusClass)&&B.classList.remove(D.containerFocusClass),!j.values.length&&O&&(O.style.opacity=1)}function x(t){t=t||e.event;var n=t.keyCode;return I(),_(n)&&""!==H.value?(S(t),undefined):(j.values.length&&w(t),undefined)}function A(t){t=t||e.event,H.classList.remove("taggle_back"),l(P,H.value)}function S(t){t=t||e.event,L(t),t.preventDefault?t.preventDefault():t.returnValue=!1}function I(){var e=P.getBoundingClientRect().width,t=q.container.rect.width-q.container.padding,n=parseInt(P.style.fontSize,10);e+1.5*n>parseInt(H.style.width,10)&&(H.style.width=t+"px")}function R(e){var n=t.createElement("li"),a=t.createElement("a"),i=t.createElement("input"),s=t.createElement("span");return e=e.toLowerCase(),a.href="javascript:void(0)",a.innerHTML="&times;",a.className="close",a.onclick=k.bind(null,a),l(s,e),s.className="taggle_text",n.className="taggle "+D.additionalTagClasses,i.type="hidden",i.value=e,i.name=D.hiddenInputName,n.appendChild(s),n.appendChild(a),n.appendChild(i),j.values.push(e),j.elements.push(n),n}function k(e,t){var n,a;"li"!==e.tagName.toLowerCase()&&(e=e.parentNode),n=e.querySelector(".taggle_text"),a=n.innerText||n.textContent,D.onTagRemove(t,a),e.parentNode.removeChild(e),i(e,j),N()}var O,F=this,D=n({},o,f),q={container:{rect:null,style:null,padding:null}},B=p,j={values:[],elements:[]},M=t.createElement("ul"),z=t.createElement("li"),H=t.createElement("input"),P=t.createElement("div");D.placeholder&&(O=t.createElement("span")),"string"==typeof p&&(B=t.getElementById(p)),F.getTags=function(){return j},F.getTagElements=function(){return j.elements},F.getTagValues=function(){return j.values},F.getInput=function(){return H},F.getContainer=function(){return B},F.add=function(e){var t=a(e);if("string"==typeof e)return L(null,e);if(t)for(var n=0,i=e.length;i>n;n++)"string"==typeof e[n]&&L(null,e[n]);return F},F.remove=function(e,t){for(var n=j.values.length-1,a=!1;n>-1&&(j.values[n]===e&&(a=!0,k(j.elements[n])),!a||t);)n--;return F},h()};e.Taggle=p}(window,document);