(function(h){h.fn.taggle=function(w){var a=h.extend({},{additionalTagClasses:"",allowDuplicates:!1,duplicateTagClass:"",containerFocusClass:"active",hiddenInputName:"taggles[]",tags:null,fontSize:11,tabIndex:1,placeholder:""},w);return this.each(function(){function p(){n();var a=~~d.width(),b=~~d.find(".taggle_input").offset().left-~~d.offset().left,c=d.outerWidth()-a;n(a-b-c)}function r(a){a="A"===a.tagName?a.parentNode:a;text=a.textContent||a.innerText;text=text.slice(0,-1);l.splice(l.indexOf(text),
1)}function n(a){b.style.width=(a||10)+"px"}function s(){p();d.hasClass(a.containerFocusClass)||d.addClass(a.containerFocusClass);a.placeholder&&g.fadeOut("fast")}function t(k){k=k||window.event;var e=4.5*(a.fontSize/8)*b.value.length,c=d.outerWidth()-d.width(),c=d.outerWidth()-c;e+5>parseInt(b.style.width,10)&&(b.style.width=c+"px");e=k.keyCode;c=!1;if(188===e||9===e||13===e)c=!0;if(c&&""!==b.value){e=k||window.event;c=e.keyCode;d.find(".taggle:last");var f;if(9===c||13===c)f=h.trim(b.value.toLowerCase()),
f=h.inArray(f.toLowerCase(),l),c=d.find(".taggle_list"),a.duplicateTagClass&&c.find("."+a.duplicateTagClass).length&&c.find("."+a.duplicateTagClass).removeClass(a.duplicateTagClass),-1<f?(c.children()[f].className+=" "+a.duplicateTagClass,f=!0):f=!1;if(!f||a.allowDuplicates){f=document.createElement("li");var c=document.createElement("a"),g=document.createElement("input"),j=h.trim(b.value.toLowerCase());c.href="javascript:void(0)";c.innerHTML="&times;";c.className="close";c.onclick=q;f.innerHTML=
j;f.className="taggle "+a.additionalTagClasses;g.type="hidden";g.value=j;a.hiddenInputName&&(g.name=a.hiddenInputName);l.push(j);f.appendChild(c);f.appendChild(g);h(m).find("li:last").before(f);h(f).find(".close:last").on("click",q);b.value="";n();p()}e.preventDefault()}k=k||window.event;e=d.find(".taggle:last");""===b.value&&8===k.keyCode?e.hasClass("hot")?(r(e[0]),e.remove(),p()):e.addClass("hot"):e.hasClass("hot")&&e.removeClass("hot")}function u(){}function q(a){a=a||window.event;h(a.target).parent("li").remove();
s();r(a.target)}var d=h(this),l=[],m=document.createElement("ul"),v=document.createElement("li"),b=document.createElement("input"),g=h("<span>");m.className="taggle_list";b.type="text";b.className="taggle_input";b.tabIndex=a.tabIndex;g.css("display","none").addClass("taggle_placeholder");d.append(g);if(null!==a.tags)for(var j=0;j<a.tags.length;j++)m.innerHTML+='<li class="taggle '+a.additionalTagClasses+'">'+a.tags[j]+'<a href="javascript:void(0)" class="close">&times;</a><input type="hidden" value="'+
a.tags[j]+'" name="'+a.hiddenInputName+'"></li>',l.push(a.tags[j].toLowerCase());a.placeholder&&(g.text(a.placeholder),g.fadeIn("fast"));v.appendChild(b);m.appendChild(v);d.append(m);d.on("click",function(){b.focus()});b.onfocus=s;b.onblur=function(){b.value="";n();d.hasClass(a.containerFocusClass)&&d.removeClass(a.containerFocusClass);!l.length&&a.placeholder&&g.fadeIn("fast")};b.addEventListener?(b.addEventListener("keydown",t,!1),b.addEventListener("keyup",u,!1)):b.attachEvent&&(b.attachEvent("onkeydown",
t),b.attachEvent("onkeyup",u));d.find(".close").one("click",q)})}})(jQuery);