(function(h){h.fn.taggle=function(w){var b=h.extend({},{additionalTagClasses:"",allowDuplicates:!1,duplicateTagClass:"",containerFocusClass:"active",hiddenInputName:"taggles[]",tags:null,fontSize:11,tabIndex:1},w);return this.each(function(){function n(){m();var g=~~d.width(),a=~~d.find(".taggle_input").offset().left-~~d.offset().left,c=d.outerWidth()-g;m(g-a-c)}function r(a){a="A"===a.tagName?a.parentNode:a;text=a.textContent||a.innerText;text=text.slice(0,-1);l.splice(l.indexOf(text),1)}function m(b){a.style.width=
(b||10)+"px"}function s(){n();d.hasClass(b.containerFocusClass)||d.addClass(b.containerFocusClass)}function t(g){g=g||window.event;var e=4.5*(b.fontSize/8)*a.value.length,c=d.outerWidth()-d.width(),c=d.outerWidth()-c;e+5>parseInt(a.style.width,10)&&(a.style.width=c+"px");e=g.keyCode;c=!1;if(188===e||9===e||13===e)c=!0;if(c&&""!==a.value){e=g;c=e.keyCode;d.find(".taggle:last");var f;if(9===c||13===c)f=h.trim(a.value.toLowerCase()),f=h.inArray(f.toLowerCase(),l),c=d.find(".taggle_list"),b.duplicateTagClass&&
c.find("."+b.duplicateTagClass).length&&c.find("."+b.duplicateTagClass).removeClass(b.duplicateTagClass),-1<f?(c.children()[f].className+=" "+b.duplicateTagClass,f=!0):f=!1;if(!f||b.allowDuplicates){f=document.createElement("li");var c=document.createElement("a"),j=document.createElement("input"),p=h.trim(a.value.toLowerCase());c.href="javascript:void(0)";c.innerHTML="&times;";c.className="close";c.onclick=q;f.innerHTML=p;f.className="taggle "+b.additionalTagClasses;j.type="hidden";j.value=p;b.hiddenInputName&&
(j.name=b.hiddenInputName);l.push(p);f.appendChild(c);f.appendChild(j);h(k).find("li:last").before(f);h(f).find(".close:last").on("click",q);a.value="";m();n()}e.preventDefault()}8===g.keyCode&&(g=g||window.event,e=d.find(".taggle:last"),""===a.value&&8===g.keyCode?e.hasClass("hot")?(r(e[0]),e.remove(),n()):e.addClass("hot"):e.hasClass("hot")&&e.removeClass("hot"))}function u(){}function q(a){a=a||window.event;h(a.target).parent("li").remove();s();r(a.target)}var d=h(this),l=[],k=document.createElement("ul"),
v=document.createElement("li"),a=document.createElement("input");k.className="taggle_list";a.type="text";a.className="taggle_input";a.tabIndex=b.tabIndex;if(null!==b.tags)for(var j=0;j<b.tags.length;j++)k.innerHTML+='<li class="taggle '+b.additionalTagClasses+'">'+b.tags[j]+'<a href="javascript:void(0)" class="close">&times;</a></li>',l.push(b.tags[j].toLowerCase());v.appendChild(a);k.appendChild(v);d.append(k);d.on("click",function(){a.focus()});a.onfocus=s;a.onblur=function(){a.value="";m();d.hasClass(b.containerFocusClass)&&
d.removeClass(b.containerFocusClass)};a.addEventListener?(a.addEventListener("keydown",t,!1),a.addEventListener("keyup",u,!1)):a.attachEvent&&(a.attachEvent("onkeydown",t),a.attachEvent("onkeyup",u));d.find(".close").one("click",q)})}})(jQuery);