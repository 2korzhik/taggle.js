(function(e,t){function a(){if(!(2>arguments.length)){for(var e=arguments[0],t=1,a=arguments.length;a>t;t++){var n=arguments[t];for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o])}return e}}function n(e,t){var a="a"===e.tagName.toLowerCase()?e.parentNode:e,n=t.elements.indexOf(a);t.elements.splice(n,1),t.values.splice(n,1)}function o(e,t,a){e.addEventListener?e.addEventListener(t,a,!1):e.attachEvent?e.attachEvent("on"+t,a):e["on"+t]=a}function i(e){return e.replace(/^\s+|\s+$/g,"")}function l(t,a){e.attachEvent&&!e.addEventListener?t.innerText=a:t.textContent=a}var r={additionalTagClasses:"",allowDuplicates:!1,duplicateTagClass:"",containerFocusClass:"active",hiddenInputName:"taggles[]",tags:[],tabIndex:1,placeholder:"Enter tags..."},s=8,c=188,u=9,d=13,h=function(e,n){var o=this;o.container=e,o.options=a({},r,n),o.tag={values:[],elements:[]},o.measurements={container:{rect:null,style:null,side_padding:null}},o.list=t.createElement("ul"),o.input_li=t.createElement("li"),o.input=t.createElement("input"),o.options.placeholder&&(o.placeholder=t.createElement("span")),"string"==typeof e&&(o.container=t.getElementById(e)),o.init()};h.prototype.init=function(){var e=this;e.getMeasurements(),e.setupTextarea(),e.attachEvents()},h.prototype.getMeasurements=function(){var t,a,n,o=this;o.measurements.container.rect=o.container.getBoundingClientRect(),o.measurements.container.style=e.getComputedStyle(o.container),t=o.measurements.container.style,a=parseInt(t["padding-left"]||t.paddingLeft,10),n=parseInt(t["padding-right"]||t.paddingRight,10),o.measurements.container.side_padding=a+n},h.prototype.setupTextarea=function(){var a,n=this;if(n.list.className="taggle_list",n.input.type="text",n.input.className="taggle_input",n.input.tabIndex=n.options.tabIndex,n.sizer=t.createElement("div"),n.sizer.className="taggle_sizer",null!==n.options.tags)for(var o=0,i=n.options.tags.length;i>o;o++){var r=n.createTag(n.options.tags[o]);n.list.appendChild(r)}n.placeholder&&(n.placeholder.style.opacity=0,n.placeholder.classList.add("taggle_placeholder"),n.container.appendChild(n.placeholder),l(n.placeholder,n.options.placeholder),n.options.tags.length||(n.placeholder.style.opacity=1)),n.input_li.appendChild(n.input),n.list.appendChild(n.input_li),n.container.appendChild(n.list),n.container.appendChild(n.sizer),a=e.getComputedStyle(n.input)["font-size"],n.sizer.style.fontSize=a},h.prototype.attachEvents=function(){var e=this;o(e.container,"click",function(){e.input.focus()}),e.input.onfocus=e.focusInput.bind(e),e.input.onblur=e.blurInput.bind(e),o(e.input,"keydown",e.keydownEvents.bind(e)),o(e.input,"keyup",e.keyupEvents.bind(e))},h.prototype.fixInputWidth=function(){var e,t,a,n,o,i=this;i.setInputWidth(),t=i.input.getBoundingClientRect(),a=i.measurements.container.rect,e=~~a.width,e||(e=~~a.right-~~a.left),n=~~t.left-~~a.left,o=i.measurements.container.side_padding,i.setInputWidth(e-n-o)},h.prototype.add=function(e){var t,a,n,o=this,l="string"==typeof e?e.toLowerCase():i(o.input.value.toLowerCase());return!o.options.allowDuplicates&&o.hasDupes()||""===l?o:(t=o.createTag(l),a=o.list.querySelectorAll("li"),n=a[a.length-1],o.list.insertBefore(t,n),o.input.value="",o.setInputWidth(),o.fixInputWidth(),o.focusInput(),o)},h.prototype.checkLastTag=function(t){t=t||e.event;var a=this,n=a.container.querySelectorAll(".taggle"),o=n[n.length-1],i="taggle_hot";""===a.input.value&&t.keyCode===s?o.classList.contains(i)?(a.remove(o),a.fixInputWidth(),a.focusInput()):o.classList.add(i):o.classList.contains(i)&&o.classList.remove(i)},h.prototype.setInputWidth=function(e){this.input.style.width=(e||10)+"px"},h.prototype.hasDupes=function(e){var t,a=this,n=a.input.value,o=e?e.toLowerCase():i(n.toLowerCase()),l=a.tag.values.indexOf(o),r=a.container.querySelector(".taggle_list");if(a.options.duplicateTagClass){t=r.querySelectorAll("."+a.options.duplicateTagClass);for(var s=0,c=t.length;c>s;s++)t[s].classList.remove(a.options.duplicateTagClass)}return l>-1?(a.options.duplicateTagClass&&r.childNodes[l].classList.add(a.options.duplicateTagClass),!0):!1},h.prototype.isConfirmKey=function(e){var t=e.keyCode,a=!1;return(t===c||t===u||t===d)&&(a=!0),a},h.prototype.focusInput=function(){var e=this;e.fixInputWidth(),e.container.classList.contains(e.options.containerFocusClass)||e.container.classList.add(e.options.containerFocusClass),e.placeholder&&(e.placeholder.style.opacity=0)},h.prototype.blurInput=function(){var e=this;e.input.value="",e.setInputWidth(),e.container.classList.contains(e.options.containerFocusClass)&&e.container.classList.remove(e.options.containerFocusClass),!e.tag.values.length&&e.placeholder&&(e.placeholder.style.opacity=1)},h.prototype.keydownEvents=function(t){t=t||e.event;var a=this;return a.listenForEndOfContainer(),a.isConfirmKey(t)&&""!==a.input.value?(a.confirmValidTagEvent(t),undefined):(a.tag.values.length&&a.checkLastTag(t),undefined)},h.prototype.keyupEvents=function(t){t=t||e.event;var a=this;l(a.sizer,a.input.value)},h.prototype.confirmValidTagEvent=function(t){t=t||e.event;var a=this;a.add(),t.preventDefault?t.preventDefault():t.returnValue=!1},h.prototype.listenForEndOfContainer=function(){var e=this,t=e.sizer.getBoundingClientRect().width,a=e.measurements.container.rect.width-e.measurements.container.side_padding,n=parseInt(e.sizer.style.fontSize,10);t+1.5*n>parseInt(e.input.style.width,10)&&(e.input.style.width=a+"px")},h.prototype.createTag=function(e){var a=this,n=t.createElement("li"),o=t.createElement("a"),i=t.createElement("input"),r=t.createElement("span");return e=e.toLowerCase(),o.href="javascript:void(0)",o.innerHTML="&times;",o.className="close",o.onclick=a.remove.bind(a,o),l(r,e),r.className="taggle_text",n.className="taggle "+a.options.additionalTagClasses,i.type="hidden",i.value=e,i.name=a.options.hiddenInputName,n.appendChild(r),n.appendChild(o),n.appendChild(i),a.tag.values.push(e),a.tag.elements.push(n),n},h.prototype.remove=function(t){t=t||e.event;var a=this,o=t.target||t.srcElement||t,i=o;"li"!==i.tagName.toLowerCase()&&(i=i.parentNode),i.parentNode.removeChild(i),n(i,a.tag),a.focusInput()},h.prototype.getTags=function(){return this.tag},h.prototype.getTagElements=function(){return this.tag.elements},h.prototype.getTagValues=function(){return this.tag.values},h.prototype.getInput=function(){return this.input},h.prototype.getContainer=function(){return this.container},e.Taggle=h})(window,document);