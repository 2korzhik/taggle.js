(function(t,e){function n(){if(!(2>arguments.length)){for(var t=arguments[0],e=1,n=arguments.length;n>e;e++){var a=arguments[e];for(var i in a)a.hasOwnProperty(i)&&(t[i]=a[i])}return t}}function a(t,e){var n="a"===t.tagName.toLowerCase()?t.parentNode:t,a=e.elements.indexOf(n);e.elements.splice(a,1),e.values.splice(a,1)}function i(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n}function s(t){return t.replace(/^\s+|\s+$/g,"")}function o(e,n){t.attachEvent&&!t.addEventListener?e.innerText=n:e.textContent=n}var r={additionalTagClasses:"",allowDuplicates:!1,duplicateTagClass:"",containerFocusClass:"active",hiddenInputName:"taggles[]",tags:[],tabIndex:1,placeholder:"Enter tags...",onTagAdd:function(){},onTagRemove:function(){}},l=8,p=188,u=9,c=13,d=function(t,a){var i=this;i.container=t,i.options=n({},r,a),i.tag={values:[],elements:[]},i.measurements={container:{rect:null,style:null,side_padding:null}},i.list=e.createElement("ul"),i.input_li=e.createElement("li"),i.input=e.createElement("input"),i.options.placeholder&&(i.placeholder=e.createElement("span")),"string"==typeof t&&(i.container=e.getElementById(t)),i.init()};d.prototype.init=function(){var t=this;t.getMeasurements(),t.setupTextarea(),t.attachEvents()},d.prototype.getMeasurements=function(){var e,n,a,i=this;i.measurements.container.rect=i.container.getBoundingClientRect(),i.measurements.container.style=t.getComputedStyle(i.container),e=i.measurements.container.style,n=parseInt(e["padding-left"]||e.paddingLeft,10),a=parseInt(e["padding-right"]||e.paddingRight,10),i.measurements.container.side_padding=n+a},d.prototype.setupTextarea=function(){var n,a=this;if(a.list.className="taggle_list",a.input.type="text",a.input.className="taggle_input",a.input.tabIndex=a.options.tabIndex,a.sizer=e.createElement("div"),a.sizer.className="taggle_sizer",null!==a.options.tags)for(var i=0,s=a.options.tags.length;s>i;i++){var r=a.createTag(a.options.tags[i]);a.list.appendChild(r)}a.placeholder&&(a.placeholder.style.opacity=0,a.placeholder.classList.add("taggle_placeholder"),a.container.appendChild(a.placeholder),o(a.placeholder,a.options.placeholder),a.options.tags.length||(a.placeholder.style.opacity=1)),a.input_li.appendChild(a.input),a.list.appendChild(a.input_li),a.container.appendChild(a.list),a.container.appendChild(a.sizer),n=t.getComputedStyle(a.input)["font-size"],a.sizer.style.fontSize=n},d.prototype.attachEvents=function(){var t=this;i(t.container,"click",function(){t.input.focus()}),t.input.onfocus=t.focusInput.bind(t),t.input.onblur=t.blurInput.bind(t),i(t.input,"keydown",t.keydownEvents.bind(t)),i(t.input,"keyup",t.keyupEvents.bind(t))},d.prototype.fixInputWidth=function(){var t,e,n,a,i,s=this;s.setInputWidth(),e=s.input.getBoundingClientRect(),n=s.measurements.container.rect,t=~~n.width,t||(t=~~n.right-~~n.left),a=~~e.left-~~n.left,i=s.measurements.container.side_padding,s.setInputWidth(t-a-i)},d.prototype.add=function(t,e){var n,a,i,o=this,r="string"==typeof e?e.toLowerCase():s(o.input.value.toLowerCase());return!o.options.allowDuplicates&&o.hasDupes()||""===r?o:(n=o.createTag(r),a=o.list.querySelectorAll("li"),i=a[a.length-1],o.list.insertBefore(n,i),o.options.onTagAdd(t,r),o.input.value="",o.setInputWidth(),o.fixInputWidth(),o.focusInput(),o)},d.prototype.checkLastTag=function(e){e=e||t.event;var n=this,a=n.container.querySelectorAll(".taggle"),i=a[a.length-1],s="taggle_hot",o=n.input.classList.contains("taggle_back");""!==n.input.value||e.keyCode!==l||o?i.classList.contains(s)&&i.classList.remove(s):i.classList.contains(s)?(n.input.classList.add("taggle_back"),n.remove(i,e),n.fixInputWidth(),n.focusInput()):i.classList.add(s)},d.prototype.setInputWidth=function(t){this.input.style.width=(t||10)+"px"},d.prototype.hasDupes=function(t){var e,n=this,a=n.input.value,i=t?t.toLowerCase():s(a.toLowerCase()),o=n.tag.values.indexOf(i),r=n.container.querySelector(".taggle_list");if(n.options.duplicateTagClass){e=r.querySelectorAll("."+n.options.duplicateTagClass);for(var l=0,p=e.length;p>l;l++)e[l].classList.remove(n.options.duplicateTagClass)}return o>-1?(n.options.duplicateTagClass&&r.childNodes[o].classList.add(n.options.duplicateTagClass),!0):!1},d.prototype.isConfirmKey=function(t){var e=!1;return(t===p||t===u||t===c)&&(e=!0),e},d.prototype.focusInput=function(){var t=this;t.fixInputWidth(),t.container.classList.contains(t.options.containerFocusClass)||t.container.classList.add(t.options.containerFocusClass),t.placeholder&&(t.placeholder.style.opacity=0)},d.prototype.blurInput=function(){var t=this;t.input.value="",t.setInputWidth(),t.container.classList.contains(t.options.containerFocusClass)&&t.container.classList.remove(t.options.containerFocusClass),!t.tag.values.length&&t.placeholder&&(t.placeholder.style.opacity=1)},d.prototype.keydownEvents=function(e){e=e||t.event;var n=this,a=e.keyCode;return n.listenForEndOfContainer(),n.isConfirmKey(a)&&""!==n.input.value?(n.confirmValidTagEvent(e),undefined):(n.tag.values.length&&n.checkLastTag(e),undefined)},d.prototype.keyupEvents=function(e){e=e||t.event;var n=this;n.input.classList.remove("taggle_back"),o(n.sizer,n.input.value)},d.prototype.confirmValidTagEvent=function(e){e=e||t.event,this.add(e),e.preventDefault?e.preventDefault():e.returnValue=!1},d.prototype.listenForEndOfContainer=function(){var t=this,e=t.sizer.getBoundingClientRect().width,n=t.measurements.container.rect.width-t.measurements.container.side_padding,a=parseInt(t.sizer.style.fontSize,10);e+1.5*a>parseInt(t.input.style.width,10)&&(t.input.style.width=n+"px")},d.prototype.createTag=function(t){var n=this,a=e.createElement("li"),i=e.createElement("a"),s=e.createElement("input"),r=e.createElement("span");return t=t.toLowerCase(),i.href="javascript:void(0)",i.innerHTML="&times;",i.className="close",i.onclick=n.remove.bind(n,i),o(r,t),r.className="taggle_text",a.className="taggle "+n.options.additionalTagClasses,s.type="hidden",s.value=t,s.name=n.options.hiddenInputName,a.appendChild(r),a.appendChild(i),a.appendChild(s),n.tag.values.push(t),n.tag.elements.push(a),a},d.prototype.remove=function(t,e){var n,i,s=this;"li"!==t.tagName.toLowerCase()&&(t=t.parentNode),n=t.querySelector(".taggle_text"),i=n.innerText||n.textContent,s.options.onTagRemove(e,i),t.parentNode.removeChild(t),a(t,s.tag),s.focusInput()},d.prototype.getTags=function(){return this.tag},d.prototype.getTagElements=function(){return this.tag.elements},d.prototype.getTagValues=function(){return this.tag.values},d.prototype.getInput=function(){return this.input},d.prototype.getContainer=function(){return this.container},t.Taggle=d})(window,document);