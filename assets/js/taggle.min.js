(function(e,t){function a(){if(!(2>arguments.length)){for(var e=arguments[0],t=1,a=arguments.length;a>t;t++){var n=arguments[t];for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}return e}}function n(e,t){var a="a"===e.tagName.toLowerCase()?e.parentNode:e,n=t.elements.indexOf(a);t.elements.splice(n,1),t.values.splice(n,1)}function i(e,t,a){e.addEventListener?e.addEventListener(t,a,!1):e.attachEvent?e.attachEvent("on"+t,a):e["on"+t]=a}function o(e){return e.replace(/^\s+|\s+$/g,"")}function l(t,a){e.attachEvent&&!e.addEventListener?t.innerText=a:t.textContent=a}var s={additionalTagClasses:"",allowDuplicates:!1,duplicateTagClass:"",containerFocusClass:"active",hiddenInputName:"taggles[]",tags:[],tabIndex:1,placeholder:"Enter tags..."},r=8,c=188,u=9,d=13,h=function(e,n){var i=this;i.container=e,i.options=a({},s,n),i.tag={values:[],elements:[]},i.measurements={container:{rect:null,style:null,side_padding:null}},i.list=t.createElement("ul"),i.input_li=t.createElement("li"),i.input=t.createElement("input"),i.options.placeholder&&(i.placeholder=t.createElement("span")),"string"==typeof e&&(i.container=t.getElementById(e)),i.init()};h.prototype.init=function(){var e=this;e.getMeasurements(),e.setupTextarea(),e.attachEvents()},h.prototype.getMeasurements=function(){var t,a,n,i=this;i.measurements.container.rect=i.container.getBoundingClientRect(),i.measurements.container.style=e.getComputedStyle(i.container),t=i.measurements.container.style,a=parseInt(t["padding-left"]||t.paddingLeft,10),n=parseInt(t["padding-right"]||t.paddingRight,10),i.measurements.container.side_padding=a+n},h.prototype.setupTextarea=function(){var a,n=this;if(n.list.className="taggle_list",n.input.type="text",n.input.className="taggle_input",n.input.tabIndex=n.options.tabIndex,n.sizer=t.createElement("div"),n.sizer.className="taggle_sizer",null!==n.options.tags)for(var i=0,o=n.options.tags.length;o>i;i++){var s=n.createTag(n.options.tags[i]);n.list.appendChild(s)}n.placeholder&&(n.placeholder.style.opacity=0,n.placeholder.classList.add("taggle_placeholder"),n.container.appendChild(n.placeholder),l(n.placeholder,n.options.placeholder),n.options.tags.length||(n.placeholder.style.opacity=1)),n.input_li.appendChild(n.input),n.list.appendChild(n.input_li),n.container.appendChild(n.list),n.container.appendChild(n.sizer),a=e.getComputedStyle(n.input)["font-size"],n.sizer.style.fontSize=a},h.prototype.attachEvents=function(){var e=this;i(e.container,"click",function(){e.input.focus()}),e.input.onfocus=e.focusInput.bind(e),e.input.onblur=e.blurInput.bind(e),i(e.input,"keydown",e.keydownEvents.bind(e)),i(e.input,"keyup",e.keyupEvents.bind(e))},h.prototype.fixInputWidth=function(){var e,t,a,n,i,o=this;o.setInputWidth(),t=o.input.getBoundingClientRect(),a=o.measurements.container.rect,e=~~a.width,e||(e=~~a.right-~~a.left),n=~~t.left-~~a.left,i=o.measurements.container.side_padding,o.setInputWidth(e-n-i)},h.prototype.add=function(e){var t,a,n,i=this,l="string"==typeof e?e.toLowerCase():o(i.input.value.toLowerCase());return!i.options.allowDuplicates&&i.hasDupes()||""===l?i:(t=i.createTag(l),a=i.list.querySelectorAll("li"),n=a[a.length-1],i.list.insertBefore(t,n),i.input.value="",i.setInputWidth(),i.fixInputWidth(),i.focusInput(),i)},h.prototype.checkLastTag=function(t){t=t||e.event;var a=this,n=a.container.querySelectorAll(".taggle"),i=n[n.length-1],o="taggle_hot",l=a.input.classList.contains("taggle_back");""!==a.input.value||t.keyCode!==r||l?i.classList.contains(o)&&i.classList.remove(o):i.classList.contains(o)?(a.input.classList.add("taggle_back"),a.remove(i),a.fixInputWidth(),a.focusInput()):i.classList.add(o)},h.prototype.setInputWidth=function(e){this.input.style.width=(e||10)+"px"},h.prototype.hasDupes=function(e){var t,a=this,n=a.input.value,i=e?e.toLowerCase():o(n.toLowerCase()),l=a.tag.values.indexOf(i),s=a.container.querySelector(".taggle_list");if(a.options.duplicateTagClass){t=s.querySelectorAll("."+a.options.duplicateTagClass);for(var r=0,c=t.length;c>r;r++)t[r].classList.remove(a.options.duplicateTagClass)}return l>-1?(a.options.duplicateTagClass&&s.childNodes[l].classList.add(a.options.duplicateTagClass),!0):!1},h.prototype.isConfirmKey=function(e){var t=!1;return(e===c||e===u||e===d)&&(t=!0),t},h.prototype.focusInput=function(){var e=this;e.fixInputWidth(),e.container.classList.contains(e.options.containerFocusClass)||e.container.classList.add(e.options.containerFocusClass),e.placeholder&&(e.placeholder.style.opacity=0)},h.prototype.blurInput=function(){var e=this;e.input.value="",e.setInputWidth(),e.container.classList.contains(e.options.containerFocusClass)&&e.container.classList.remove(e.options.containerFocusClass),!e.tag.values.length&&e.placeholder&&(e.placeholder.style.opacity=1)},h.prototype.keydownEvents=function(t){t=t||e.event;var a=this,n=t.keyCode;return a.listenForEndOfContainer(),a.isConfirmKey(n)&&""!==a.input.value?(a.confirmValidTagEvent(t),undefined):(a.tag.values.length&&a.checkLastTag(t),undefined)},h.prototype.keyupEvents=function(t){t=t||e.event;var a=this;a.input.classList.remove("taggle_back"),l(a.sizer,a.input.value)},h.prototype.confirmValidTagEvent=function(t){t=t||e.event;var a=this;a.add(),t.preventDefault?t.preventDefault():t.returnValue=!1},h.prototype.listenForEndOfContainer=function(){var e=this,t=e.sizer.getBoundingClientRect().width,a=e.measurements.container.rect.width-e.measurements.container.side_padding,n=parseInt(e.sizer.style.fontSize,10);t+1.5*n>parseInt(e.input.style.width,10)&&(e.input.style.width=a+"px")},h.prototype.createTag=function(e){var a=this,n=t.createElement("li"),i=t.createElement("a"),o=t.createElement("input"),s=t.createElement("span");return e=e.toLowerCase(),i.href="javascript:void(0)",i.innerHTML="&times;",i.className="close",i.onclick=a.remove.bind(a,i),l(s,e),s.className="taggle_text",n.className="taggle "+a.options.additionalTagClasses,o.type="hidden",o.value=e,o.name=a.options.hiddenInputName,n.appendChild(s),n.appendChild(i),n.appendChild(o),a.tag.values.push(e),a.tag.elements.push(n),n},h.prototype.remove=function(t){t=t||e.event;var a=this,i=t.target||t.srcElement||t,o=i;"li"!==o.tagName.toLowerCase()&&(o=o.parentNode),o.parentNode.removeChild(o),n(o,a.tag),a.focusInput()},h.prototype.getTags=function(){return this.tag},h.prototype.getTagElements=function(){return this.tag.elements},h.prototype.getTagValues=function(){return this.tag.values},h.prototype.getInput=function(){return this.input},h.prototype.getContainer=function(){return this.container},e.Taggle=h})(window,document);